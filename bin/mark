#!/bin/bash

# mark - AI prompt templating tool
# Main entry point

# Get the absolute path of this script
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Source configuration
source "$SCRIPT_DIR/../lib/core/config.sh"

# Source core functions
source "$SCRIPT_DIR/../lib/core/logging.sh"

# Source utility functions
source "$SCRIPT_DIR/../lib/utils/parser.sh"
source "$SCRIPT_DIR/../lib/utils/processor.sh"

# Source command functions
source "$SCRIPT_DIR/../lib/commands/generate.sh"
source "$SCRIPT_DIR/../lib/commands/list.sh"
source "$SCRIPT_DIR/../lib/commands/clear.sh"
source "$SCRIPT_DIR/../lib/commands/help.sh"

# Main command router
case "${1:-}" in
    generate)
        if [[ -z "$2" ]]; then
            log "ERROR: Missing template argument for generate command"
            echo "Error: Missing template argument for generate command" >&2
            show_help
            exit 1
        fi
        generate_prompt "$2" "$3"
        ;;
    list)
        list_prompts
        ;;
    clear)
        clear_logs
        ;;
    help|--help|-h)
        show_help
        log "Help displayed"
        ;;
    "")
        log "ERROR: No command provided"
        echo "Error: No command provided" >&2
        show_help
        exit 1
        ;;
    *)
        log "ERROR: Unknown command '$1'"
        echo "Error: Unknown command '$1'" >&2
        show_help
        exit 1
        ;;
esac