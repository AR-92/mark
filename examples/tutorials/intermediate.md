# mark Intermediate Tutorial\n\nThis tutorial builds on the beginner concepts and dives deeper into `mark`'s powerful features for creating more sophisticated prompt templates.\n\n## Table of Contents\n\n1. [Advanced Conditional Logic](#advanced-conditional-logic)\n2. [Complex Loop Structures](#complex-loop-structures)\n3. [Nested Templates](#nested-templates)\n4. [Environment Variable Integration](#environment-variable-integration)\n5. [Working with Complex Data Structures](#working-with-complex-data-structures)\n\n## Advanced Conditional Logic\n\n### Multiple Conditions with Nested Blocks\n\nCreate `advanced_conditional_template.md`:\n\n```markdown\n# {{project_type}} Project Assistant\n\n{{#if security_critical}}\n{{#if compliance_required}}\n**SECURITY & COMPLIANCE CRITICAL PROJECT**\n{{else}}\n**SECURITY CRITICAL PROJECT**\n{{/if}}\n{{else}}\n{{#if compliance_required}}\n**COMPLIANCE CRITICAL PROJECT**\n{{/if}}\n{{/if}}\n\nProject: {{project_name}}\n\n{{#if team_size}}\nTeam Size: {{team_size}} developers\n{{/if}}\n\n{{#if timeline_weeks}}\nTimeline: {{timeline_weeks}} weeks\n{{/if}}\n\n{{#if technology_stack}}\nTechnology Stack:\n{{#each technology_stack}}\n- {{this}}\n{{/each}}\n{{/if}}\n\nTask: {{task_description}}\n\n{{#if security_critical}}\n## Security Considerations\n{{#each security_considerations}}\n- {{this}}\n{{/each}}\n{{/if}}\n\n{{#if compliance_required}}\n## Compliance Requirements\n{{#each compliance_requirements}}\n- {{this}}\n{{/each}}\n{{/if}}\n\nPlease provide a detailed plan addressing all specified requirements.\n```\n\nCreate data file `advanced_conditional_data.md`:\n\n```markdown\nproject_type=Web Application\nsecurity_critical=true\ncompliance_required=true\nproject_name=Healthcare Patient Portal\nteam_size=5\ntimeline_weeks=12\ntechnology_stack_0=React\ntechnology_stack_1=Node.js\ntechnology_stack_2=MongoDB\ntechnology_stack_3=Redis\ntask_description=Develop a patient portal for viewing medical records and scheduling appointments\nsecurity_considerations_0=HIPAA compliance for data handling\nsecurity_considerations_1=End-to-end encryption for data in transit\nsecurity_considerations_2=Multi-factor authentication\nsecurity_considerations_3=Regular security audits\ncompliance_requirements_0=HIPAA compliance documentation\ncompliance_requirements_1=Regular compliance training for team members\ncompliance_requirements_2=Audit trails for all patient data access\n```\n\nGenerate the prompt:\n\n```bash\n./mark generate advanced_conditional_template.md advanced_conditional_data.md\n```\n\n### Conditional Logic with Else If Patterns\n\nWhile `mark` doesn't have explicit else-if support, you can simulate it with nested conditionals. Create `elseif_template.md`:\n\n```markdown\n# {{system_type}} Configuration Assistant\n\n{{#if system_type}}\n{{#if system_type == \"WebServer\"}}\nThis is a web server configuration task.\n{{else}}\n{{#if system_type == \"Database\"}}\nThis is a database configuration task.\n{{else}}\n{{#if system_type == \"Network\"}}\nThis is a network configuration task.\n{{else}}\nThis is a general system configuration task.\n{{/if}}\n{{/if}}\n{{/if}}\n{{/if}}\n\nSystem: {{system_name}}\nOS: {{operating_system}}\n\n{{#if environment}}\nEnvironment: {{environment}}\n{{/if}}\n\nTask: {{configuration_task}}\n\n{{#if system_type == \"WebServer\"}}\n## Web Server Specific Considerations\n{{#each webserver_considerations}}\n- {{this}}\n{{/each}}\n{{else}}\n{{#if system_type == \"Database\"}}\n## Database Specific Considerations\n{{#each database_considerations}}\n- {{this}}\n{{/each}}\n{{else}}\n{{#if system_type == \"Network\"}}\n## Network Specific Considerations\n{{#each network_considerations}}\n- {{this}}\n{{/each}}\n{{/if}}\n{{/if}}\n{{/if}}\n\nPlease provide a comprehensive configuration plan.\n```\n\nCreate data file `elseif_data.md`:\n\n```markdown\nsystem_type=Database\nsystem_name=CustomerDB\noperating_system=Ubuntu 20.04\nenvironment=Production\nconfiguration_task=Optimize PostgreSQL for high-concurrency read operations\ndatabase_considerations_0=Connection pooling configuration\ndatabase_considerations_1=Index optimization for read-heavy queries\ndatabase_considerations_2=Memory allocation tuning\ndatabase_considerations_3=Replication setup for read scaling\n```\n\nNote: The above template uses a pattern that simulates else-if behavior. However, `mark` currently evaluates conditions as truthy/falsy rather than doing string comparisons. For actual conditional logic, you would need to structure your data differently.\n\nA better approach for this use case would be:\n\nCreate `elseif_better_template.md`:\n\n```markdown\n# {{system_category}} Configuration Assistant\n\n{{#if is_webserver}}\nThis is a web server configuration task.\n{{/if}}\n\n{{#if is_database}}\nThis is a database configuration task.\n{{/if}}\n\n{{#if is_network}}\nThis is a network configuration task.\n{{/if}}\n\n{{#if is_general}}\nThis is a general system configuration task.\n{{/if}}\n\nSystem: {{system_name}}\nOS: {{operating_system}}\n\n{{#if environment}}\nEnvironment: {{environment}}\n{{/if}}\n\nTask: {{configuration_task}}\n\n{{#if is_webserver}}\n## Web Server Specific Considerations\n{{#each webserver_considerations}}\n- {{this}}\n{{/each}}\n{{/if}}\n\n{{#if is_database}}\n## Database Specific Considerations\n{{#each database_considerations}}\n- {{this}}\n{{/each}}\n{{/if}}\n\n{{#if is_network}}\n## Network Specific Considerations\n{{#each network_considerations}}\n- {{this}}\n{{/each}}\n{{/if}}\n\nPlease provide a comprehensive configuration plan.\n```\n\nCreate data file `elseif_better_data.md`:\n\n```markdown\nsystem_category=Database\nis_database=true\nsystem_name=CustomerDB\noperating_system=Ubuntu 20.04\nenvironment=Production\nconfiguration_task=Optimize PostgreSQL for high-concurrency read operations\ndatabase_considerations_0=Connection pooling configuration\ndatabase_considerations_1=Index optimization for read-heavy queries\ndatabase_considerations_2=Memory allocation tuning\ndatabase_considerations_3=Replication setup for read scaling\n```\n\nGenerate the prompt:\n\n```bash\n./mark generate elseif_better_template.md elseif_better_data.md\n```\n\n## Complex Loop Structures\n\n### Nested Loops\n\nCreate `nested_loops_template.md`:\n\n```markdown\n# {{project_name}} Development Plan\n\nProject Manager: {{project_manager}}\n\n## Development Phases\n\n{{#each phases}}\n### Phase {{@index}}: {{this.name}}\n\nDuration: {{this.duration}}\n\n#### Tasks in this Phase\n{{#each this.tasks}}\n- {{this.name}} ({{this.estimated_hours}} hours)\n{{/each}}\n\n#### Deliverables\n{{#each this.deliverables}}\n- {{this}}\n{{/each}}\n\n{{/each}}\n\n## Resource Allocation\n\n{{#each team_members}}\n### {{this.name}} - {{this.role}}\n\nSkills:\n{{#each this.skills}}\n- {{this}}\n{{/each}}\n\nAssigned Phases:\n{{#each this.assigned_phases}}\n- {{this}}\n{{/each}}\n\n{{/each}}\n\nPlease review this development plan and provide feedback.\n```\n\nCreate data file `nested_loops_data.md`:\n\n```markdown\nproject_name=E-commerce Platform\nproject_manager=Jane Smith\nphases_0.name=Planning and Design\nphases_0.duration=2 weeks\nphases_0.tasks_0.name=Requirements gathering\nphases_0.tasks_0.estimated_hours=40\nphases_0.tasks_1.name=System architecture design\nphases_0.tasks_1.estimated_hours=60\nphases_0.deliverables_0=Requirements document\nphases_0.deliverables_1=System architecture diagram\nphases_1.name=Frontend Development\nphases_1.duration=6 weeks\nphases_1.tasks_0.name=UI/UX implementation\nphases_1.tasks_0.estimated_hours=120\nphases_1.tasks_1.name=Component development\nphases_1.tasks_1.estimated_hours=160\nphases_1.deliverables_0=Frontend components\nphases_1.deliverables_1=UI prototype\nphases_2.name=Backend Development\nphases_2.duration=8 weeks\nphases_2.tasks_0.name=API development\nphases_2.tasks_0.estimated_hours=200\nphases_2.tasks_1.name=Database design and implementation\nphases_2.tasks_1.estimated_hours=100\nphases_2.deliverables_0=REST API\nphases_2.deliverables_1=Database schema\nteam_members_0.name=Alice Johnson\nteam_members_0.role=Frontend Developer\nteam_members_0.skills_0=React\nteam_members_0.skills_1=CSS\nteam_members_0.skills_2=JavaScript\nteam_members_0.assigned_phases_0=Frontend Development\nteam_members_0.assigned_phases_1=Planning and Design\nteam_members_1.name=Bob Smith\nteam_members_1.role=Backend Developer\nteam_members_1.skills_0=Node.js\nteam_members_1.skills_1=PostgreSQL\nteam_members_1.skills_2=REST APIs\nteam_members_1.assigned_phases_0=Backend Development\nteam_members_1.assigned_phases_1=Planning and Design\n```\n\nGenerate the prompt:\n\n```bash\n./mark generate nested_loops_template.md nested_loops_data.md\n```\n\n### Loops with Conditional Content\n\nCreate `conditional_loops_template.md`:\n\n```markdown\n# {{project_name}} Testing Strategy\n\nProject Type: {{project_type}}\n\n## Test Scenarios\n\n{{#each test_scenarios}}\n### Scenario {{@index}}: {{this.name}}\n\n{{#if this.description}}\nDescription: {{this.description}}\n{{/if}}\n\n{{#if this.priority}}\nPriority: {{this.priority}}\n{{/if}}\n\n{{#if this.requires_environment_setup}}\n**Requires Special Environment Setup**\n{{/if}}\n\nTest Steps:\n{{#each this.steps}}\n{{@index}}. {{this}}\n{{/each}}\n\n{{#if this.expected_outcomes}}\nExpected Outcomes:\n{{#each this.expected_outcomes}}\n- {{this}}\n{{/each}}\n{{/if}}\n\n{{#if this.edge_cases}}\nEdge Cases to Consider:\n{{#each this.edge_cases}}\n- {{this}}\n{{/each}}\n{{/if}}\n\n---\n\n{{/each}}\n\nPlease execute these test scenarios and document the results.\n```\n\nCreate data file `conditional_loops_data.md`:\n\n```markdown\nproject_name=Mobile Banking App\nproject_type=Financial Services\ntest_scenarios_0.name=User Authentication\ntest_scenarios_0.description=Verify user can log in with valid credentials\ntest_scenarios_0.priority=High\ntest_scenarios_0.requires_environment_setup=false\ntest_scenarios_0.steps_0=Launch the app\ntest_scenarios_0.steps_1=Enter valid username and password\ntest_scenarios_0.steps_2=Tap login button\ntest_scenarios_0.expected_outcomes_0=User is redirected to dashboard\ntest_scenarios_0.expected_outcomes_1=No error messages displayed\ntest_scenarios_1.name=Fund Transfer\ntest_scenarios_1.description=Verify user can transfer funds between accounts\ntest_scenarios_1.priority=High\ntest_scenarios_1.requires_environment_setup=true\ntest_scenarios_1.steps_0=Log in to the app\ntest_scenarios_1.steps_1=Navigate to transfer funds screen\ntest_scenarios_1.steps_2=Select source and destination accounts\ntest_scenarios_1.steps_3=Enter transfer amount\ntest_scenarios_1.steps_4=Confirm transfer\ntest_scenarios_1.expected_outcomes_0=Transfer is successful\ntest_scenarios_1.expected_outcomes_1=Balances are updated correctly\ntest_scenarios_1.edge_cases_0=Transfer amount exceeds available balance\ntest_scenarios_1.edge_cases_1=Transfer to invalid account number\ntest_scenarios_2.name=Offline Mode\ntest_scenarios_2.description=Verify app behavior when network is unavailable\ntest_scenarios_2.priority=Medium\ntest_scenarios_2.requires_environment_setup=true\ntest_scenarios_2.steps_0=Put device in airplane mode\ntest_scenarios_2.steps_1=Launch the app\ntest_scenarios_2.steps_2=Attempt to view account information\ntest_scenarios_2.expected_outcomes_0=App displays cached data\ntest_scenarios_2.expected_outcomes_1=App shows appropriate offline message\n```\n\nGenerate the prompt:\n\n```bash\n./mark generate conditional_loops_template.md conditional_loops_data.md\n```\n\n## Nested Templates\n\n### Template Reuse with Parameters\n\nCreate `reusable_component_template.md`:\n\n```markdown\n{{#if component_type == \"api_endpoint\"}}\n## API Endpoint: {{endpoint_name}}\n\nMethod: {{http_method}}\nPath: {{endpoint_path}}\n\n{{#if endpoint_description}}\nDescription: {{endpoint_description}}\n{{/if}}\n\n{{#if request_parameters}}\nRequest Parameters:\n{{#each request_parameters}}\n- {{this.name}} ({{this.type}}){{#if this.required}} - Required{{/if}}{{#if this.description}}: {{this.description}}{{/if}}\n{{/each}}\n{{/if}}\n\n{{#if response_structure}}\nResponse Structure:\n```json\n{{response_structure}}\n```\n{{/if}}\n\n{{#if error_responses}}\nError Responses:\n{{#each error_responses}}\n- {{this.code}}: {{this.description}}\n{{/each}}\n{{/if}}\n{{/if}}\n\n{{#if component_type == \"database_table\"}}\n## Database Table: {{table_name}}\n\n{{#if table_description}}\nDescription: {{table_description}}\n{{/if}}\n\nColumns:\n{{#each columns}}\n- {{this.name}} ({{this.type}}){{#if this.constraints}} {{this.constraints}}{{/if}}{{#if this.description}}: {{this.description}}{{/if}}\n{{/each}}\n\n{{#if relationships}}\nRelationships:\n{{#each relationships}}\n- {{this}}\n{{/each}}\n{{/if}}\n\n{{#if indexes}}\nIndexes:\n{{#each indexes}}\n- {{this}}\n{{/each}}\n{{/if}}\n{{/if}}\n```\n\nCreate main template `api_documentation_template.md`:\n\n```markdown\n# {{api_name}} API Documentation\n\nVersion: {{api_version}}\nBase URL: {{base_url}}\n\n{{#if api_description}}\n{{api_description}}\n{{/if}}\n\n## Endpoints\n\n{{@reusable_component_template.md}}\n\n{{@reusable_component_template.md}}\n\n## Database Schema\n\n{{@reusable_component_template.md}}\n```\n\nCreate data file `api_documentation_data.md`:\n\n```markdown\napi_name=User Management\napi_version=v1.0\nbase_url=https://api.example.com/v1\napi_description=API for managing user accounts, authentication, and profiles\ncomponent_type=api_endpoint\nendpoint_name=Create User\nhttp_method=POST\nendpoint_path=/users\nendpoint_description=Create a new user account\nrequest_parameters_0.name=email\nrequest_parameters_0.type=string\nrequest_parameters_0.required=true\nrequest_parameters_0.description=User's email address\nrequest_parameters_1.name=password\nrequest_parameters_1.type=string\nrequest_parameters_1.required=true\nrequest_parameters_1.description=User's password\nrequest_parameters_2.name=name\nrequest_parameters_2.type=string\nrequest_parameters_2.required=false\nrequest_parameters_2.description=User's full name\nresponse_structure={\n  \"id\": 123,\n  \"email\": \"user@example.com\",\n  \"name\": \"John Doe\",\n  \"created_at\": \"2023-01-01T00:00:00Z\"\n}\nerror_responses_0.code=400\nerror_responses_0.description=Invalid request data\nerror_responses_1.code=409\nerror_responses_1.description=Email already exists\ncomponent_type_1=api_endpoint\nendpoint_name_1=Get User\nhttp_method_1=GET\nendpoint_path_1=/users/{id}\nendpoint_description_1=Retrieve user account information\nresponse_structure_1={\n  \"id\": 123,\n  \"email\": \"user@example.com\",\n  \"name\": \"John Doe\",\n  \"created_at\": \"2023-01-01T00:00:00Z\"\n}\nerror_responses_1_0.code=404\nerror_responses_1_0.description=User not found\ncomponent_type_2=database_table\ntable_name=users\ntable_description=Stores user account information\ncolumns_0.name=id\ncolumns_0.type=INTEGER\ncolumns_0.constraints=PRIMARY KEY, AUTO_INCREMENT\ncolumns_1.name=email\ncolumns_1.type=VARCHAR(255)\ncolumns_1.constraints=NOT NULL, UNIQUE\ncolumns_2.name=password_hash\ncolumns_2.type=VARCHAR(255)\ncolumns_2.constraints=NOT NULL\ncolumns_3.name=name\ncolumns_3.type=VARCHAR(255)\ncolumns_4.name=created_at\ncolumns_4.type=TIMESTAMP\ncolumns_4.constraints=NOT NULL, DEFAULT CURRENT_TIMESTAMP\nindexes_0=INDEX idx_email (email)\n```\n\nNote that the above approach has a limitation - the same template file is being included multiple times with different data. In `mark`, we need to create separate template files for each inclusion. Let's revise the approach:\n\nCreate `api_endpoint_template.md`:\n\n```markdown\n## API Endpoint: {{endpoint_name}}\n\nMethod: {{http_method}}\nPath: {{endpoint_path}}\n\n{{#if endpoint_description}}\nDescription: {{endpoint_description}}\n{{/if}}\n\n{{#if request_parameters}}\nRequest Parameters:\n{{#each request_parameters}}\n- {{this.name}} ({{this.type}}){{#if this.required}} - Required{{/if}}{{#if this.description}}: {{this.description}}{{/if}}\n{{/each}}\n{{/if}}\n\n{{#if response_structure}}\nResponse Structure:\n```json\n{{response_structure}}\n```\n{{/if}}\n\n{{#if error_responses}}\nError Responses:\n{{#each error_responses}}\n- {{this.code}}: {{this.description}}\n{{/each}}\n{{/if}}\n```\n\nCreate `database_table_template.md`:\n\n```markdown\n## Database Table: {{table_name}}\n\n{{#if table_description}}\nDescription: {{table_description}}\n{{/if}}\n\nColumns:\n{{#each columns}}\n- {{this.name}} ({{this.type}}){{#if this.constraints}} {{this.constraints}}{{/if}}{{#if this.description}}: {{this.description}}{{/if}}\n{{/each}}\n\n{{#if relationships}}\nRelationships:\n{{#each relationships}}\n- {{this}}\n{{/each}}\n{{/if}}\n\n{{#if indexes}}\nIndexes:\n{{#each indexes}}\n- {{this}}\n{{/each}}\n{{/if}}\n```\n\nCreate main template `api_documentation_template_v2.md`:\n\n```markdown\n# {{api_name}} API Documentation\n\nVersion: {{api_version}}\nBase URL: {{base_url}}\n\n{{#if api_description}}\n{{api_description}}\n{{/if}}\n\n## Endpoints\n\n{{@api_endpoint_template.md}}\n\n{{@api_endpoint_template.md}}\n\n## Database Schema\n\n{{@database_table_template.md}}\n```\n\nCreate data file `api_documentation_data_v2.md`:\n\n```markdown\napi_name=User Management\napi_version=v1.0\nbase_url=https://api.example.com/v1\napi_description=API for managing user accounts, authentication, and profiles\nendpoint_name=Create User\nhttp_method=POST\nendpoint_path=/users\nendpoint_description=Create a new user account\nrequest_parameters_0.name=email\nrequest_parameters_0.type=string\nrequest_parameters_0.required=true\nrequest_parameters_0.description=User's email address\nrequest_parameters_1.name=password\nrequest_parameters_1.type=string\nrequest_parameters_1.required=true\nrequest_parameters_1.description=User's password\nrequest_parameters_2.name=name\nrequest_parameters_2.type=string\nrequest_parameters_2.required=false\nrequest_parameters_2.description=User's full name\nresponse_structure={\n  \"id\": 123,\n  \"email\": \"user@example.com\",\n  \"name\": \"John Doe\",\n  \"created_at\": \"2023-01-01T00:00:00Z\"\n}\nerror_responses_0.code=400\nerror_responses_0.description=Invalid request data\nerror_responses_1.code=409\nerror_responses_1.description=Email already exists\nendpoint_name_1=Get User\nhttp_method_1=GET\nendpoint_path_1=/users/{id}\nendpoint_description_1=Retrieve user account information\nresponse_structure_1={\n  \"id\": 123,\n  \"email\": \"user@example.com\",\n  \"name\": \"John Doe\",\n  \"created_at\": \"2023-01-01T00:00:00Z\"\n}\nerror_responses_1_0.code=404\nerror_responses_1_0.description=User not found\ntable_name=users\ntable_description=Stores user account information\ncolumns_0.name=id\ncolumns_0.type=INTEGER\ncolumns_0.constraints=PRIMARY KEY, AUTO_INCREMENT\ncolumns_1.name=email\ncolumns_1.type=VARCHAR(255)\ncolumns_1.constraints=NOT NULL, UNIQUE\ncolumns_2.name=password_hash\ncolumns_2.type=VARCHAR(255)\ncolumns_2.constraints=NOT NULL\ncolumns_3.name=name\ncolumns_3.type=VARCHAR(255)\ncolumns_4.name=created_at\ncolumns_4.type=TIMESTAMP\ncolumns_4.constraints=NOT NULL, DEFAULT CURRENT_TIMESTAMP\nindexes_0=INDEX idx_email (email)\n```\n\nGenerate the prompt:\n\n```bash\n./mark generate api_documentation_template_v2.md api_documentation_data_v2.md\n```\n\n## Environment Variable Integration\n\n### Dynamic Context from Environment\n\nCreate `environment_template.md`:\n\n```markdown\n# {{task_domain}} Assistant\n\nCurrent Environment:\n- Time: {{current_time}}\n- User: {{user}}\n- Host: {{hostname}}\n- Working Directory: {{pwd}}\n\n{{#if CI}}\n**Running in CI Environment**\n{{/if}}\n\n{{#if DEBUG}}\n**Debug Mode Enabled**\nDebug Information:\n- Debug Level: {{DEBUG_LEVEL}}\n- Log File: {{LOG_FILE}}\n{{/if}}\n\nTask: {{task_description}}\n\n{{#if additional_context}}\nAdditional Context:\n{{#each additional_context}}\n- {{this}}\n{{/each}}\n{{/if}}\n\nPlease complete this task with the provided context.\n```\n\nCreate data file `environment_data.md`:\n\n```markdown\ntask_domain=Deployment\ntask_description=Deploy the latest version of the web application\nadditional_context_0=Deployment target: staging environment\nadditional_context_1=Rollback plan is in place\nadditional_context_2=Monitoring alerts configured\n```\n\nGenerate the prompt with environment variables:\n\n```bash\nexport current_time=$(date)\nexport user=$(whoami)\nexport hostname=$(hostname)\nexport pwd=$(pwd)\nexport CI=true\nexport DEBUG=true\nexport DEBUG_LEVEL=verbose\nexport LOG_FILE=/var/log/deployment.log\n\n./mark generate environment_template.md environment_data.md\n```\n\n### Configuration-Based Templates\n\nCreate `config_template.md`:\n\n```markdown\n# {{application_name}} Configuration\n\nEnvironment: {{environment}}\n\n{{#if environment == \"production\"}}\n**PRODUCTION ENVIRONMENT - HANDLE WITH CARE**\n{{/if}}\n\n{{#if environment == \"staging\"}}\n**STAGING ENVIRONMENT**\n{{/if}}\n\n{{#if environment == \"development\"}}\n**DEVELOPMENT ENVIRONMENT**\n{{/if}}\n\n## Database Configuration\nHost: {{db_host}}\nPort: {{db_port}}\nName: {{db_name}}\n{{#if db_ssl}}\nSSL: Enabled\n{{else}}\nSSL: Disabled\n{{/if}}\n\n## Cache Configuration\n{{#if cache_enabled}}\nCache: Enabled\nCache Host: {{cache_host}}\nCache Port: {{cache_port}}\n{{else}}\nCache: Disabled\n{{/if}}\n\n## Feature Flags\n{{#each features}}\n{{#if this.enabled}}\n[ENABLED]  {{this.name}}: {{this.description}}\n{{else}}\n[DISABLED] {{this.name}}: {{this.description}}\n{{/if}}\n{{/each}}\n\n## Security Settings\n{{#if security_mandatory_fields}}\nMandatory Security Fields:\n{{#each security_mandatory_fields}}\n- {{this}}\n{{/each}}\n{{/if}}\n\nPlease verify these configuration settings.\n```\n\nCreate data file `config_data.md`:\n\n```markdown\napplication_name=Customer Portal\nenvironment=production\ndb_host=db.production.internal\ndb_port=5432\ndb_name=customer_portal\ndb_ssl=true\ncache_enabled=true\ncache_host=redis.production.internal\ncache_port=6379\nfeatures_0.name=new_checkout\nfeatures_0.description=New payment processing flow\nfeatures_0.enabled=true\nfeatures_1.name=legacy_api\nfeatures_1.description=Old API endpoints for backward compatibility\nfeatures_1.enabled=false\nfeatures_2.name=analytics_dashboard\nfeatures_2.description=Enhanced analytics and reporting\nfeatures_2.enabled=true\nsecurity_mandatory_fields_0=encryption_at_rest\nsecurity_mandatory_fields_1=audit_logging\nsecurity_mandatory_fields_2=two_factor_auth\n```\n\nGenerate the prompt:\n\n```bash\n./mark generate config_template.md config_data.md\n```\n\n## Working with Complex Data Structures\n\n### Hierarchical Data Representation\n\nCreate `hierarchical_template.md`:\n\n```markdown\n# {{organization_name}} System Architecture\n\nArchitecture Version: {{architecture_version}}\n\n## System Components\n\n{{#each components}}\n### {{this.name}}\n\nType: {{this.type}}\n{{#if this.description}}\nDescription: {{this.description}}\n{{/if}}\n\n{{#if this.dependencies}}\nDependencies:\n{{#each this.dependencies}}\n- {{this}}\n{{/each}}\n{{/if}}\n\n{{#if this.interfaces}}\nInterfaces:\n{{#each this.interfaces}}\n- {{this.name}}: {{this.description}}\n{{/each}}\n{{/if}}\n\n{{#if this.scaling}}\nScaling Considerations: {{this.scaling}}\n{{/if}}\n\n{{#if this.monitoring}}\nMonitoring:\n{{#each this.monitoring}}\n- {{this}}\n{{/each}}\n{{/if}}\n\n---\n\n{{/each}}\n\n## Data Flow\n\n{{#each data_flows}}\n### {{this.name}}\n\nSource: {{this.source}}\nDestination: {{this.destination}}\n{{#if this.description}}\nDescription: {{this.description}}\n{{/if}}\n\n{{#if this.protocols}}\nProtocols:\n{{#each this.protocols}}\n- {{this}}\n{{/each}}\n{{/if}}\n\n---\n\n{{/each}}\n\nPlease review this architecture and provide feedback.\n```\n\nCreate data file `hierarchical_data.md`:\n\n```markdown\norganization_name=TechCorp\narchitecture_version=2.1\ncomponents_0.name=Web Frontend\ncomponents_0.type=UI Service\ncomponents_0.description=React-based user interface for customer interactions\ncomponents_0.dependencies_0=API Gateway\ncomponents_0.dependencies_1=Authentication Service\ncomponents_0.interfaces_0.name=REST API\ncomponents_0.interfaces_0.description=Interface to backend services\ncomponents_0.scaling=Horizontally scalable with load balancer\ncomponents_0.monitoring_0=Response time metrics\ncomponents_0.monitoring_1=Error rate tracking\ncomponents_1.name=API Gateway\ncomponents_1.type=Routing Service\ncomponents_1.description=Routes requests to appropriate backend services\ncomponents_1.dependencies_0=Authentication Service\ncomponents_1.dependencies_1=Order Service\ncomponents_1.dependencies_2=Inventory Service\ncomponents_1.interfaces_0.name=Public API\ncomponents_1.interfaces_0.description=External interface for clients\ncomponents_1.interfaces_1.name=Internal API\ncomponents_1.interfaces_1.description=Interface for backend services\ncomponents_1.scaling=Auto-scaling based on request volume\ncomponents_1.monitoring_0=Request routing metrics\ncomponents_1.monitoring_1=Latency measurements\ncomponents_2.name=Order Service\ncomponents_2.type=Business Logic\ncomponents_2.description=Handles order processing and management\ncomponents_2.dependencies_0=Inventory Service\ncomponents_2.dependencies_1=Payment Service\ncomponents_2.dependencies_2=Database\ncomponents_2.interfaces_0.name=Order API\ncomponents_2.interfaces_0.description=API for order operations\ncomponents_2.scaling=Scale based on order volume\ncomponents_2.monitoring_0=Order processing time\ncomponents_2.monitoring_1=Failure rate tracking\ndata_flows_0.name=Customer Order Processing\ndata_flows_0.source=Web Frontend\ndata_flows_0.destination=Order Service\ndata_flows_0.description=Flow of order data from frontend to order processing\ndata_flows_0.protocols_0=HTTPS\ndata_flows_0.protocols_1=JSON\ndata_flows_1.name=Inventory Update\ndata_flows_1.source=Order Service\ndata_flows_1.destination=Inventory Service\ndata_flows_1.description=Update inventory levels after order processing\ndata_flows_1.protocols_0=AMQP\ndata_flows_1.protocols_1=JSON\n```\n\nGenerate the prompt:\n\n```bash\n./mark generate hierarchical_template.md hierarchical_data.md\n```\n\n### Multi-Dimensional Data\n\nCreate `multidimensional_template.md`:\n\n```markdown\n# {{analysis_type}} Report for {{subject}}\n\nReport Period: {{report_period}}\nGenerated: {{report_date}}\n\n## Executive Summary\n\n{{executive_summary}}\n\n## Detailed Analysis\n\n{{#each analysis_dimensions}}\n### {{this.dimension_name}}\n\n{{#if this.description}}\nDescription: {{this.description}}\n{{/if}}\n\n{{#if this.metrics}}\nKey Metrics:\n{{#each this.metrics}}\n- {{this.name}}: {{this.value}}{{#if this.unit}} {{this.unit}}{{/if}}{{#if this.trend}} ({{this.trend}}){{/if}}\n{{/each}}\n{{/if}}\n\n{{#if this.segments}}\nSegment Analysis:\n{{#each this.segments}}\n#### {{this.name}}\n\n{{#if this.description}}\nDescription: {{this.description}}\n{{/if}}\n\nMetrics:\n{{#each this.metrics}}\n- {{this.name}}: {{this.value}}{{#if this.unit}} {{this.unit}}{{/if}}{{#if this.trend}} ({{this.trend}}){{/if}}\n{{/each}}\n\n{{/each}}\n{{/if}}\n\n{{#if this.insights}}\nKey Insights:\n{{#each this.insights}}\n- {{this}}\n{{/each}}\n{{/if}}\n\n---\n\n{{/each}}\n\n## Recommendations\n\n{{#each recommendations}}\n### {{@index}}. {{this.category}}\n\nPriority: {{this.priority}}\n\n{{this.description}}\n\n{{#if this.implementation_steps}}\nImplementation Steps:\n{{#each this.implementation_steps}}\n{{@index}}. {{this}}\n{{/each}}\n{{/if}}\n\nExpected Impact: {{this.expected_impact}}\n\n---\n\n{{/each}}\n\nPlease review this analysis and provide your feedback.\n```\n\nCreate data file `multidimensional_data.md`:\n\n```markdown\nanalysis_type=Market Performance\nsubject=Product Line A\nreport_period=Q2 2023\nreport_date=2023-07-15\nexecutive_summary=Product Line A showed strong growth in Q2 with a 15% increase in revenue compared to Q1. Market share improved in two key segments, but price competition intensified.\nanalysis_dimensions_0.dimension_name=Revenue Analysis\nanalysis_dimensions_0.description=Comprehensive revenue breakdown by channel and region\nanalysis_dimensions_0.metrics_0.name=Total Revenue\nanalysis_dimensions_0.metrics_0.value=$2.5M\nanalysis_dimensions_0.metrics_0.unit=\nanalysis_dimensions_0.metrics_0.trend=+15%\nanalysis_dimensions_0.metrics_1.name=YoY Growth\nanalysis_dimensions_0.metrics_1.value=22%\nanalysis_dimensions_0.metrics_1.unit=\nanalysis_dimensions_0.metrics_1.trend=+5%\nanalysis_dimensions_0.segments_0.name=Online Channel\nanalysis_dimensions_0.segments_0.description=Direct-to-consumer e-commerce sales\nanalysis_dimensions_0.segments_0.metrics_0.name=Revenue\nanalysis_dimensions_0.segments_0.metrics_0.value=$1.8M\nanalysis_dimensions_0.segments_0.metrics_0.trend=+18%\nanalysis_dimensions_0.segments_1.name=Retail Channel\nanalysis_dimensions_0.segments_1.description=Sales through retail partners\nanalysis_dimensions_0.segments_1.metrics_0.name=Revenue\nanalysis_dimensions_0.segments_1.metrics_0.value=$0.7M\nanalysis_dimensions_0.segments_1.metrics_0.trend=+8%\nanalysis_dimensions_0.insights_0=Online channel outperforming retail\nanalysis_dimensions_0.insights_1=Strong seasonal demand in Q2\nanalysis_dimensions_1.dimension_name=Customer Acquisition\nanalysis_dimensions_1.description=Analysis of new customer metrics and cost per acquisition\nanalysis_dimensions_1.metrics_0.name=New Customers\nanalysis_dimensions_1.metrics_0.value=15000\nanalysis_dimensions_1.metrics_0.trend=+25%\nanalysis_dimensions_1.metrics_1.name=Cost Per Acquisition\nanalysis_dimensions_1.metrics_1.value=$12.50\nanalysis_dimensions_1.metrics_1.unit=\nanalysis_dimensions_1.metrics_1.trend=-8%\nanalysis_dimensions_1.insights_0=Improved marketing efficiency\nanalysis_dimensions_1.insights_1=Higher conversion rates from new campaigns\nrecommendations_0.category=Channel Investment\nrecommendations_0.priority=High\nrecommendations_0.description=Increase investment in online channel marketing to capitalize on strong performance\nrecommendations_0.implementation_steps_0=Allocate 20% additional budget to digital marketing\nrecommendations_0.implementation_steps_1=Launch targeted social media campaign\nrecommendations_0.expected_impact=10% revenue increase in Q3\nrecommendations_1.category=Pricing Strategy\nrecommendations_1.priority=Medium\nrecommendations_1.description=Review pricing strategy to address competitive pressure\nrecommendations_1.implementation_steps_0=Conduct competitive pricing analysis\nrecommendations_1.implementation_steps_1=Test price adjustments with select customer segments\nrecommendations_1.expected_impact=Maintain market share while protecting margins\n```\n\nGenerate the prompt:\n\n```bash\n./mark generate multidimensional_template.md multidimensional_data.md\n```\n\n## Conclusion\n\nIn this intermediate tutorial, you've learned to:\n\n1. Implement advanced conditional logic with nested blocks\n2. Work with complex loop structures including nested loops\n3. Create reusable template components and compose them\n4. Integrate environment variables for dynamic context\n5. Represent hierarchical and multi-dimensional data in templates\n\nThese skills will allow you to create sophisticated, dynamic prompt templates that can handle complex scenarios and data structures. In the next tutorial, we'll explore advanced techniques for AI agent integration and performance optimization.